<!-- public/seed-candidates.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seed Candidates Data</title>
    <script src="https://unpkg.com/dexie@3.2.1/dist/dexie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.3.2/uuid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .progress { background: #fff3cd; color: #856404; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Seed Candidates Database</h1>
        <p>This will generate 1000+ realistic candidate records for testing.</p>
        
        <button onclick="seedCandidates()">Seed 1000+ Candidates</button>
        <button onclick="clearCandidates()" style="background: #dc3545;">Clear All Candidates</button>
        <button onclick="checkCount()">Check Candidate Count</button>
        
        <div id="status"></div>
        <div id="progress"></div>
        <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
    </div>

    <script>
        // Simple UUID generator (since Dexie.friendlyUUID is not available)
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Initialize Dexie database
        const db = new Dexie('jobPortal');
        db.version(2).stores({
            jobs: '++id, title, slug, status, order, createdAt',
            candidates: '++id, firstName, lastName, email, jobId, stage, createdAt, [jobId+stage]'
        });

        // Sample data generators
        const firstNames = [
            'James', 'Mary', 'John', 'Patricia', 'Robert', 'Jennifer', 'Michael', 'Linda', 
            'William', 'Elizabeth', 'David', 'Susan', 'Richard', 'Jessica', 'Joseph', 'Sarah',
            'Thomas', 'Karen', 'Charles', 'Nancy', 'Christopher', 'Lisa', 'Daniel', 'Betty',
            'Matthew', 'Dorothy', 'Anthony', 'Sandra', 'Mark', 'Ashley', 'Donald', 'Kimberly',
            'Steven', 'Donna', 'Paul', 'Emily', 'Andrew', 'Michelle', 'Joshua', 'Carol',
            'Kevin', 'Amanda', 'Brian', 'Melissa', 'George', 'Deborah', 'Timothy', 'Stephanie',
            'Ronald', 'Rebecca', 'Jason', 'Laura', 'Edward', 'Sharon', 'Jeffrey', 'Cynthia',
            'Ryan', 'Kathleen', 'Jacob', 'Amy', 'Gary', 'Angela', 'Nicholas', 'Shirley',
            'Eric', 'Emma', 'Jonathan', 'Anna', 'Stephen', 'Brenda', 'Larry', 'Pamela',
            'Justin', 'Nicole', 'Scott', 'Samantha', 'Brandon', 'Katherine', 'Benjamin', 'Christine',
            'Samuel', 'Helen', 'Gregory', 'Debra', 'Alexander', 'Rachel', 'Patrick', 'Carolyn',
            'Frank', 'Janet', 'Raymond', 'Maria', 'Jack', 'Catherine', 'Dennis', 'Heather',
            'Jerry', 'Diane', 'Tyler', 'Olivia', 'Aaron', 'Julie', 'Jose', 'Joyce',
            'Adam', 'Victoria', 'Nathan', 'Kelly', 'Henry', 'Christina', 'Douglas', 'Lauren',
            'Zachary', 'Joan', 'Peter', 'Evelyn', 'Kyle', 'Judith', 'Ethan', 'Megan',
            'Walter', 'Cheryl', 'Noah', 'Andrea', 'Jeremy', 'Hannah', 'Christian', 'Martha',
            'Keith', 'Jacqueline', 'Roger', 'Frances', 'Terry', 'Gloria', 'Gerald', 'Ann',
            'Harold', 'Teresa', 'Sean', 'Kathryn', 'Austin', 'Sara', 'Arthur', 'Janice',
            'Lawrence', 'Jean', 'Jesse', 'Alice', 'Dylan', 'Madison', 'Bryan', 'Doris',
            'Joe', 'Abigail', 'Jordan', 'Julia', 'Billy', 'Judy', 'Bruce', 'Grace',
            'Albert', 'Denise', 'Willie', 'Amber', 'Gabriel', 'Marilyn', 'Logan', 'Beverly',
            'Alan', 'Danielle', 'Juan', 'Theresa', 'Wayne', 'Sophia', 'Roy', 'Marie',
            'Ralph', 'Diana', 'Randy', 'Brittany', 'Philip', 'Natalie', 'Eugene', 'Isabella',
            'Vincent', 'Charlotte', 'Russell', 'Rose', 'Elijah', 'Alexis', 'Louis', 'Kayla'
        ];

        const lastNames = [
            'Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis',
            'Rodriguez', 'Martinez', 'Hernandez', 'Lopez', 'Gonzalez', 'Wilson', 'Anderson',
            'Thomas', 'Taylor', 'Moore', 'Jackson', 'Martin', 'Lee', 'Perez', 'Thompson',
            'White', 'Harris', 'Sanchez', 'Clark', 'Ramirez', 'Lewis', 'Robinson', 'Walker',
            'Young', 'Allen', 'King', 'Wright', 'Scott', 'Torres', 'Nguyen', 'Hill', 'Flores',
            'Green', 'Adams', 'Nelson', 'Baker', 'Hall', 'Rivera', 'Campbell', 'Mitchell',
            'Carter', 'Roberts', 'Gomez', 'Phillips', 'Evans', 'Turner', 'Diaz', 'Parker',
            'Cruz', 'Edwards', 'Collins', 'Reyes', 'Stewart', 'Morris', 'Morales', 'Murphy',
            'Cook', 'Rogers', 'Gutierrez', 'Ortiz', 'Morgan', 'Cooper', 'Peterson', 'Bailey',
            'Reed', 'Kelly', 'Howard', 'Ramos', 'Kim', 'Cox', 'Ward', 'Richardson',
            'Watson', 'Brooks', 'Chavez', 'Wood', 'James', 'Bennett', 'Gray', 'Mendoza',
            'Ruiz', 'Hughes', 'Price', 'Alvarez', 'Castillo', 'Sanders', 'Patel', 'Myers',
            'Long', 'Ross', 'Foster', 'Jimenez', 'Powell', 'Jenkins', 'Perry', 'Russell',
            'Sullivan', 'Bell', 'Coleman', 'Butler', 'Henderson', 'Barnes', 'Gonzales',
            'Fisher', 'Vasquez', 'Simmons', 'Romero', 'Jordan', 'Patterson', 'Alexander',
            'Hamilton', 'Graham', 'Reynolds', 'Griffin', 'Wallace', 'Moreno', 'West',
            'Cole', 'Hayes', 'Bryant', 'Herrera', 'Gibson', 'Ellis', 'Tran', 'Medina',
            'Aguilar', 'Stevens', 'Murray', 'Ford', 'Castro', 'Marshall', 'Owens', 'Harrison',
            'Fernandez', 'Mcdonald', 'Woods', 'Washington', 'Kennedy', 'Wells', 'Vargas',
            'Henry', 'Chen', 'Freeman', 'Webb', 'Tucker', 'Guzman', 'Burns', 'Crawford',
            'Olson', 'Simpson', 'Porter', 'Hunter', 'Gordon', 'Mendez', 'Silva', 'Shaw',
            'Snyder', 'Mason', 'Dixon', 'Munoz', 'Hubbard', 'Hart', 'Larson', 'Frazier'
        ];

        const domains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', 'company.com'];
        const skills = [
            'JavaScript', 'React', 'Node.js', 'Python', 'Java', 'AWS', 'Docker', 'Kubernetes', 
            'TypeScript', 'Vue', 'Angular', 'PHP', 'Ruby', 'Go', 'Rust', 'SQL', 'MongoDB',
            'PostgreSQL', 'GraphQL', 'Redis', 'Jenkins', 'Git', 'CI/CD', 'Agile', 'Scrum',
            'HTML5', 'CSS3', 'SASS', 'Webpack', 'Babel', 'Express', 'Django', 'Flask',
            'Spring', 'Hibernate', 'MySQL', 'Oracle', 'Azure', 'GCP', 'Linux', 'Windows',
            'MacOS', 'iOS', 'Android', 'Swift', 'Kotlin', 'React Native', 'Flutter',
            'Machine Learning', 'AI', 'Data Analysis', 'Tableau', 'Power BI', 'Excel',
            'Photoshop', 'Figma', 'Sketch', 'UI/UX', 'Wireframing', 'Prototyping',
            'Project Management', 'JIRA', 'Confluence', 'Slack', 'Teams', 'Zoom',
            'Customer Service', 'Sales', 'Marketing', 'SEO', 'SEM', 'Content Writing',
            'Technical Writing', 'Documentation', 'Training', 'Mentoring', 'Leadership'
        ];
        
        const jobTitles = [
            'Frontend Developer', 'Backend Developer', 'Full Stack Developer', 'DevOps Engineer',
            'Data Scientist', 'ML Engineer', 'Product Manager', 'UX Designer', 'QA Engineer',
            'Mobile Developer', 'System Administrator', 'Security Engineer', 'Cloud Architect',
            'Database Administrator', 'Network Engineer', 'Business Analyst', 'Scrum Master',
            'Technical Lead', 'Software Architect', 'IT Manager', 'CTO', 'CEO', 'CFO',
            'Marketing Manager', 'Sales Executive', 'HR Specialist', 'Recruiter', 'Accountant'
        ];

        const stages = ['applied', 'screening', 'interview', 'technical', 'offer', 'hired', 'rejected'];

        function generateRandomName() {
            const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
            const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
            return { firstName, lastName };
        }

        function generateEmail(firstName, lastName) {
            const domain = domains[Math.floor(Math.random() * domains.length)];
            const variations = [
                `${firstName.toLowerCase()}.${lastName.toLowerCase()}@${domain}`,
                `${firstName.toLowerCase()}${lastName.toLowerCase()}@${domain}`,
                `${firstName.charAt(0).toLowerCase()}${lastName.toLowerCase()}@${domain}`,
                `${firstName.toLowerCase()}_${lastName.toLowerCase()}@${domain}`
            ];
            return variations[Math.floor(Math.random() * variations.length)];
        }

        function generatePhone() {
            return `+1-${Math.floor(100 + Math.random() * 900)}-${Math.floor(100 + Math.random() * 900)}-${Math.floor(1000 + Math.random() * 9000)}`;
        }

        function generateTags() {
            const numTags = Math.floor(Math.random() * 4) + 2; // 2-5 tags
            const shuffled = [...skills].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, numTags);
        }

        function generateRating() {
            // More candidates with average ratings, fewer with extreme ratings
            const rand = Math.random();
            if (rand < 0.1) return 1; // 10% 1-star
            if (rand < 0.3) return 2; // 20% 2-star
            if (rand < 0.6) return 3; // 30% 3-star
            if (rand < 0.85) return 4; // 25% 4-star
            return 5; // 15% 5-star
        }

        function generateCandidate(jobId, jobTitle) {
            const { firstName, lastName } = generateRandomName();
            const email = generateEmail(firstName, lastName);
            
            // Generate applied date within last 90 days
            const appliedDate = new Date();
            appliedDate.setDate(appliedDate.getDate() - Math.floor(Math.random() * 90));
            
            // Weighted stage distribution (more in early stages)
            const stageWeights = [0.25, 0.20, 0.15, 0.12, 0.10, 0.10, 0.08];
            const random = Math.random();
            let stageIndex = 0;
            let weightSum = 0;
            
            for (let i = 0; i < stageWeights.length; i++) {
                weightSum += stageWeights[i];
                if (random <= weightSum) {
                    stageIndex = i;
                    break;
                }
            }
            
            const stage = stages[stageIndex];
            const rating = generateRating();
            const tags = generateTags();
            
            // Generate last contact date (if applicable)
            let lastContactDate = null;
            if (stage !== 'applied') {
                const daysSinceApplied = Math.floor((new Date() - appliedDate) / (1000 * 60 * 60 * 24));
                const contactOffset = Math.floor(Math.random() * daysSinceApplied);
                lastContactDate = new Date(appliedDate.getTime() + contactOffset * 24 * 60 * 60 * 1000);
            }

            // Generate notes based on rating and stage
            let notes = '';
            if (Math.random() > 0.5) {
                const noteTemplates = [
                    `Strong experience in ${tags[0]}.`,
                    `Good cultural fit for the team.`,
                    `Requires additional technical screening.`,
                    `Excellent communication skills.`,
                    `Previous experience in similar role.`,
                    `Looking for career growth opportunities.`,
                    `Available to start immediately.`,
                    `Requires visa sponsorship.`,
                    `Local candidate - no relocation needed.`,
                    `Great portfolio and project examples.`
                ];
                notes = noteTemplates[Math.floor(Math.random() * noteTemplates.length)];
            }

            return {
                id: generateUUID(),
                firstName,
                lastName,
                email,
                phone: generatePhone(),
                jobId,
                jobTitle,
                stage,
                rating,
                tags,
                appliedDate,
                lastContactDate,
                notes,
                createdAt: new Date(),
                updatedAt: new Date()
            };
        }

        async function getJobIds() {
            try {
                const jobs = await db.jobs.toArray();
                if (jobs.length === 0) {
                    throw new Error('No jobs found in database. Please seed jobs first.');
                }
                return jobs.map(job => ({ id: job.id, title: job.title }));
            } catch (error) {
                console.error('Error fetching jobs:', error);
                throw error;
            }
        }

        async function seedCandidates() {
            const statusEl = document.getElementById('status');
            const progressEl = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            
            try {
                statusEl.innerHTML = '<div class="progress">Starting candidate generation...</div>';
                progressBar.style.display = 'block';
                
                const jobs = await getJobIds();
                const totalCandidates = 1200;
                const candidatesPerJob = Math.ceil(totalCandidates / jobs.length);
                
                let candidatesCreated = 0;
                const allCandidates = [];
                
                statusEl.innerHTML = `<div class="info">Generating ${totalCandidates} candidates across ${jobs.length} jobs...</div>`;
                
                // Generate candidates for each job
                for (const job of jobs) {
                    for (let i = 0; i < candidatesPerJob; i++) {
                        if (candidatesCreated >= totalCandidates) break;
                        
                        const candidate = generateCandidate(job.id, job.title);
                        allCandidates.push(candidate);
                        candidatesCreated++;
                        
                        // Update progress
                        if (candidatesCreated % 50 === 0) {
                            const progress = (candidatesCreated / totalCandidates) * 100;
                            progressFill.style.width = `${progress}%`;
                            progressEl.innerHTML = `<div class="info">Generated ${candidatesCreated}/${totalCandidates} candidates (${Math.round(progress)}%)...</div>`;
                            // Small delay to allow UI update
                            await new Promise(resolve => setTimeout(resolve, 10));
                        }
                    }
                }
                
                progressEl.innerHTML = `<div class="info">Adding ${candidatesCreated} candidates to database...</div>`;
                
                // Batch insert in chunks to avoid memory issues
                const chunkSize = 100;
                for (let i = 0; i < allCandidates.length; i += chunkSize) {
                    const chunk = allCandidates.slice(i, i + chunkSize);
                    await db.candidates.bulkAdd(chunk);
                    
                    const progress = ((i + chunk.length) / allCandidates.length) * 100;
                    progressFill.style.width = `${progress}%`;
                    progressEl.innerHTML = `<div class="info">Added ${Math.min(i + chunk.length, allCandidates.length)}/${allCandidates.length} candidates to database...</div>`;
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
                
                statusEl.innerHTML = `<div class="success">✅ Successfully created ${candidatesCreated} candidates across ${jobs.length} jobs!</div>`;
                progressEl.innerHTML = '';
                progressBar.style.display = 'none';
                
            } catch (error) {
                statusEl.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
                progressBar.style.display = 'none';
                console.error('Seeding error:', error);
            }
        }

        async function clearCandidates() {
            const statusEl = document.getElementById('status');
            try {
                await db.candidates.clear();
                statusEl.innerHTML = `<div class="success">✅ All candidates have been cleared from the database.</div>`;
            } catch (error) {
                statusEl.innerHTML = `<div class="error">❌ Error clearing candidates: ${error.message}</div>`;
            }
        }

        async function checkCount() {
            const statusEl = document.getElementById('status');
            try {
                const count = await db.candidates.count();
                const jobsCount = await db.jobs.count();
                statusEl.innerHTML = `<div class="info">📊 There are currently ${count} candidates and ${jobsCount} jobs in the database.</div>`;
            } catch (error) {
                statusEl.innerHTML = `<div class="error">❌ Error checking count: ${error.message}</div>`;
            }
        }

        // Initialize by checking current count
        window.addEventListener('load', checkCount);
    </script>
</body>
</html>